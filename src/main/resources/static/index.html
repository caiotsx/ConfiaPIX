<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ConfiaPIX - Validador de Comprovantes</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

  <header>
    <div class="logo">
      <img src="https://cdn-icons-png.flaticon.com/512/684/684908.png" alt="Logo">
      <span>ConfiaPIX</span>
    </div>
    <div class="user">
      <img src="https://cdn-icons-png.flaticon.com/512/219/219969.png" alt="User" id="userPhoto">
      <span id="userName">Ol√°, <b>User!</b></span>
    </div>
  </header>

  <main>
    <div class="upload-area">
      <input type="file" id="fileInput" accept="image/*,application/pdf" style="display:none;">
      <button id="selectFileBtn">Selecionar Comprovante</button>
      <p>ou arraste e solte o comprovante aqui.</p>
    </div>

    <h3>PR√âVIA DO ARQUIVO</h3>

    <div class="preview" id="preview">
      <img id="imagePreview" style="display:none;">
      <iframe id="pdfPreview" style="display:none;" height="400"></iframe>
      <p class="file-name" id="fileName"></p>
    </div>

    <div class="buttons">
      <button class="btn-remove" id="removeBtn">REMOVER ARQUIVO</button>
      <button class="btn-validate" id="validateBtn">VALIDAR COMPROVANTE</button>
    </div>

    <div id="status"></div>
  </main>

  <script>
    // ===== Atualizar nome e foto do usu√°rio =====
    window.addEventListener('DOMContentLoaded', () => {
      const storedUser = localStorage.getItem('confiaPIX_user');
      const userPhoto = document.getElementById('userPhoto');
      const userName = document.getElementById('userName');

      if (storedUser) {
        const user = JSON.parse(storedUser);
        if (user.username) {
          userName.innerHTML = `Ol√°, <b>${user.username}</b>!`;
        }
        if (user.photo) {
          userPhoto.src = user.photo;
        }
      } else {
        // Se n√£o estiver logado, redireciona para login
        window.location.href = 'login.html';
      }
    });

    // ===== L√≥gica de upload e valida√ß√£o =====
    const fileInput = document.getElementById('fileInput');
    const selectFileBtn = document.getElementById('selectFileBtn');
    const preview = document.getElementById('preview');
    const imagePreview = document.getElementById('imagePreview');
    const pdfPreview = document.getElementById('pdfPreview');
    const fileName = document.getElementById('fileName');
    const removeBtn = document.getElementById('removeBtn');
    const validateBtn = document.getElementById('validateBtn');
    const statusBox = document.getElementById('status');

    selectFileBtn.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', function () {
      const file = this.files[0];
      if (!file) return;

      const fileURL = URL.createObjectURL(file);
      preview.style.display = 'block';
      fileName.textContent = file.name;

      if (file.type === 'application/pdf') {
        pdfPreview.src = fileURL;
        pdfPreview.style.display = 'block';
        imagePreview.style.display = 'none';
      } else if (file.type.startsWith('image/')) {
        imagePreview.src = fileURL;
        imagePreview.style.display = 'block';
        pdfPreview.style.display = 'none';
      }
    });

    removeBtn.addEventListener('click', () => {
      fileInput.value = '';
      preview.style.display = 'none';
      imagePreview.src = '';
      pdfPreview.src = '';
      fileName.textContent = '';
      statusBox.style.display = 'none';
    });

    validateBtn.addEventListener('click', async () => {
      const file = fileInput.files[0];
      if (!file) {
        alert("Por favor, selecione um comprovante antes de validar.");
        return;
      }

      statusBox.style.display = 'block';
      statusBox.style.background = '#fff8e1';
      statusBox.style.color = '#444';
      statusBox.textContent = 'Validando comprovante...';

      const formData = new FormData();
      formData.append('comprovante', file);

      try {
        // üîó Substitua pela URL real da sua API:
        const response = await fetch('https://suaapi.com/api/validar-comprovante', {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (result.status === 'v√°lido') {
            statusBox.style.background = '#e0f2f1';
            statusBox.style.color = '#00796b';
            statusBox.textContent = `‚úÖ ${result.mensagem}`;
        } else if (result.status === 'falso') {
            statusBox.style.background = '#ffebee';
            statusBox.style.color = '#c62828';
            statusBox.textContent = `‚ùå ${result.mensagem}`;
        } else {
            statusBox.style.background = '#fff3e0';
            statusBox.style.color = '#ef6c00';
            statusBox.textContent = `‚ö†Ô∏è ${result.mensagem}`;
        }

    } catch (error) {
        statusBox.style.background = '#ffebee';
        statusBox.style.color = '#c62828';
        statusBox.textContent = 'Erro ao validar o comprovante. Tente novamente.';
    }
});
  </script>

</body>
</html>
